<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Results Portal</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background-color: #3f51b5;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .search-section {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        input[type="text"] {
            padding: 10px;
            width: 200px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            padding: 10px 20px;
            background-color: #3f51b5;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
        }
        
        button:hover {
            background-color: #303f9f;
        }
        
        .result-card {
            display: none;
            padding: 20px;
        }
        
        .school-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .school-logo {
            width: 120px;
            height: 100px;
            margin: 0 auto;
            border-radius: 0; /* Remove circular shape */
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent; /* Remove background */
        } 
        
        .student-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 5px;
        }
        
        .student-info-item {
            flex: 1;
        }
        
        .subjects-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        
        .subjects-table th, .subjects-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .subjects-table th {
            background-color: #f5f5f5;
        }
        
        .grade-a {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .grade-b {
            color: #2196F3;
            font-weight: bold;
        }
        
        .grade-c {
            color: #FF9800;
            font-weight: bold;
        }
        
        .grade-f {
            color: #F44336;
            font-weight: bold;
        }
        
        .summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .total-section, .result-section {
            flex: 1;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
            margin: 0 10px;
        }
        
        .result-section {
            text-align: center;
        }
        
        .pass {
            color: #4CAF50;
            font-size: 24px;
            font-weight: bold;
        }
        
        .fail {
            color: #F44336;
            font-size: 24px;
            font-weight: bold;
        }
        
        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
        }
        
        .signature {
            flex: 1;
            text-align: center;
            padding: 0 20px;
        }
        
        .signature-image {
            max-width: 150px;
            height: 60px;
            margin: 10px auto;
            display: block;
        }
        
        .signature-line {
            width: 80%;
            margin: 40px auto 10px;
            border-bottom: 1px solid #000;
        }
        
        .error-message {
            color: #F44336;
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .print-button {
            text-align: center;
            margin: 20px 0;
        }
        
        @media print {
            .search-section {
                display: none;
            }
            
            .container {
                box-shadow: none;
            }
            
            body {
                background-color: white;
            }
            
            .header {
                display: none;  /* Hide the header when printing */
            }
            
            .print-button {
                display: none;  /* Hide the print button when printing */
            }
        }
.subjects-table th:nth-child(1),
.subjects-table th:nth-child(1),   
.subjects-table th:nth-child(2),
.subjects-table td:nth-child(2),
.subjects-table th:nth-child(3),
.subjects-table td:nth-child(3),
.subjects-table th:nth-child(4),
.subjects-table td:nth-child(4) {
    text-align: center;
} </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Exam Results Portal</h1>
        </div>
        
        <div class="search-section">
            <input type="text" id="rollNumber" placeholder="Enter 5 Digits Admisson No.">
            <button onclick="fetchResult()">Get Result</button>
        </div>
        
        <div class="error-message" id="errorMessage">
            Student record not found. Please check the Enrollment number and try again.
        </div>
        
        <div class="result-card" id="resultCard">
            <div class="school-info">
                <div class="school-logo">
                    <img src="https://i.imgur.com/WFR0DSR.png" alt="KVS" style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <h2 id="schoolName">School Name</h2>
                <p>Examination Results <span id="examYear">2025</span></p>
            </div>
            
            <div class="student-info">
                <div class="student-info-item">
                    <p><strong>Name:</strong> <span id="studentName">John Doe</span></p>
                    <p><strong>Enrollment No:</strong> <span id="studentRoll">12345</span></p>
                </div>
                <div class="student-info-item">
                    <p><strong>Class:</strong> <span id="studentClass">X-A</span></p>
                    <p><strong>Exam:</strong> <span id="examName">Final Term</span></p>
                </div>
            </div>
            
            <table class="subjects-table">
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>Max Marks</th>
                        <th>Marks Obtained</th>
                        <th>Grade</th>
                    </tr>
                </thead>
                <tbody id="marksTableBody">
                    <!-- Subject marks will be inserted here -->
                </tbody>
            </table>
            
            <div class="summary">
                <div class="total-section">
                    <p><strong>Total Marks:</strong> <span id="totalObtained">0</span>/<span id="totalMax">0</span></p>
                    <p><strong>Percentage:</strong> <span id="percentage">0</span>%</p>
                    <p><strong>Remark:</strong> <span id="cgpa">0.0</span></p>
                </div>
                <div class="result-section">
                    <p><strong>Result</strong></p>
                    <p id="resultStatus" class="pass">PASS</p>
                </div>
            </div>
            
            <div class="signature-section">
                <div class="signature">
                    <img id="examInchargeSignature" src="Exam Incharge.png" alt="Exam Incharge Signature" class="signature-image">
                    <p>Exam Incharge</p>
                </div>
                <div class="signature">
                    <img id="principalSignature" src="principal/HM-signature.png" alt="Principal/HM Signature" class="signature-image">
                    <p>Principal/HM</p>
                </div>
            </div>
            <div class="print-button">
                <button id="printButton" style="background-color: #4CAF50;">Print Result</button>
            </div>
        </div>
    </div>

    <script>
        // Replace with your Google Sheet ID and API key
        const SHEET_ID = '116NbAamZahJdmH04jV4ZahzedoW6eliZqKl0Q6tLvv4'; // The ID you copied from the URL
        const API_KEY = 'AIzaSyCNqaTLpfOIVBOyjIiWDsET5N4CU-16qCA'; // The API key you created

        async function fetchDataFromGoogleSheets(rollNumber) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/VE?key=${API_KEY}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                // Process the data to find the student
                const rows = data.values;
                const headers = rows[0]; // First row contains headers
                
                // Find the indexes of important columns
                const rollIndex = headers.indexOf('Roll_Number');
                const nameIndex = headers.indexOf('Name');
                const classIndex = headers.indexOf('Class');
                const schoolIndex = headers.indexOf('School');
                const examInchargeSignatureIndex = headers.indexOf('ExamInchargeSignature');
                const principalSignatureIndex = headers.indexOf('PrincipalSignature');
                const totalMarksIndex = headers.indexOf('Total_Marks');
                const totalObtainedIndex = headers.indexOf('Total_Obtained');
                const percentageIndex = headers.indexOf('Percentage');
                const cgpaIndex = headers.indexOf('CGPA');
                const resultIndex = headers.indexOf('Result');
                
                // Find subject columns (they should be between Class and Total_Marks)
                const subjectColumns = [];
                for (let i = classIndex + 1; i < totalMarksIndex; i++) {
                    if (headers[i]) {
                        subjectColumns.push({ index: i, name: headers[i] });
                    }
                }
                
                // Look for the student with matching roll number
                for (let i = 1; i < rows.length; i++) {
                    if (rows[i][rollIndex] === rollNumber) {
                        // Found the student, now format the data
                        const studentData = {
                            name: rows[i][nameIndex],
                            class: rows[i][classIndex],
                            school: schoolIndex !== -1 ? rows[i][schoolIndex] : 'PM SHRI KENDRIYA VIDYALAYA RAEBARELI',
                            examInchargeSignature: examInchargeSignatureIndex !== -1 ? rows[i][examInchargeSignatureIndex] : 'Exam Incharge.png',
                            principalSignature: principalSignatureIndex !== -1 ? rows[i][principalSignatureIndex] : 'principal/HM-signature.png',
                            totalMarks: parseInt(rows[i][totalMarksIndex]),
                            totalObtained: parseInt(rows[i][totalObtainedIndex]),
                            percentage: parseFloat(rows[i][percentageIndex]),
                            cgpa: rows[i][cgpaIndex], // Keep as string to allow text remarks
                            result: rows[i][resultIndex],
                            subjects: []
                        };
                        
                        // Process subject marks
                        subjectColumns.forEach(subject => {
                            const marks = parseInt(rows[i][subject.index]);
                            studentData.subjects.push({
                                name: subject.name,
                                maxMarks: 100, // Assuming max marks is 100 for each subject
                                obtained: marks,
                                grade: calculateGrade(marks)
                            });
                        });
                        
                        return studentData;
                    }
                }
                return null; // Student not found
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        function calculateGrade(marks) {
            if (marks >= 90) return 'A';
            else if (marks >= 80) return 'B';
            else if (marks >= 70) return 'C';
            else if (marks >= 60) return 'D';
            else return 'F';
        }

        function getGradeClass(grade) {
            switch(grade) {
                case 'A': return 'grade-a';
                case 'B': return 'grade-b';
                case 'C': return 'grade-c';
                case 'F': return 'grade-f';
                default: return '';
            }
        }
        
        function printResult() {
            window.print();
        }

        function displayResult(data, rollNumber) {
            // Set student info
            document.getElementById('studentName').textContent = data.name;
            document.getElementById('studentRoll').textContent = rollNumber;
            document.getElementById('studentClass').textContent = data.class;
            document.getElementById('examYear').textContent = new Date().getFullYear();
            document.getElementById('schoolName').textContent = data.school;
            document.getElementById('examName').textContent = 'Final Term';
            
            // Set signature images
            document.getElementById('examInchargeSignature').src = data.examInchargeSignature;
            document.getElementById('principalSignature').src = data.principalSignature;
            
            // Clear previous table rows
            const tableBody = document.getElementById('marksTableBody');
            tableBody.innerHTML = '';
            
            // Add subject rows
            data.subjects.forEach(subject => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = subject.name;
                
                const maxMarksCell = document.createElement('td');
                maxMarksCell.textContent = subject.maxMarks;
                
                const obtainedCell = document.createElement('td');
                obtainedCell.textContent = subject.obtained;
                
                const gradeCell = document.createElement('td');
                gradeCell.textContent = subject.grade;
                gradeCell.className = getGradeClass(subject.grade);
                
                row.appendChild(nameCell);
                row.appendChild(maxMarksCell);
                row.appendChild(obtainedCell);
                row.appendChild(gradeCell);
                
                tableBody.appendChild(row);
            });
            
            // Set summary information
            document.getElementById('totalObtained').textContent = data.totalObtained;
            document.getElementById('totalMax').textContent = data.totalMarks;
            document.getElementById('percentage').textContent = data.percentage;
            document.getElementById('cgpa').textContent = data.cgpa;
            
            // Set result
            const resultStatus = document.getElementById('resultStatus');
            resultStatus.textContent = data.result;
            resultStatus.className = data.result === 'PASS' ? 'pass' : 'fail';
        }

        function fetchResult() {
            const rollNumber = document.getElementById('rollNumber').value;
            const resultCard = document.getElementById('resultCard');
            const errorMessage = document.getElementById('errorMessage');
            
            // Reset display
            resultCard.style.display = 'none';
            errorMessage.style.display = 'none';
            
            // Show loading indicator (you might want to add this element to your HTML)
            // document.getElementById('loadingIndicator').style.display = 'block';
            
            // Fetch data from Google Sheets
            fetchDataFromGoogleSheets(rollNumber).then(data => {
                // Hide loading indicator
                // document.getElementById('loadingIndicator').style.display = 'none';
                
                if (data) {
                    displayResult(data, rollNumber);
                    resultCard.style.display = 'block';
                } else {
                    errorMessage.style.display = 'block';
                }
            });
        }
        
        // Add event listener for print button
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('printButton').addEventListener('click', function() {
                window.print();
            });
        });
    </script>
</body>
</html>
